<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <label for="url">https://api.crackwatch.com/api/games?</label>
    <input type="text"  name="url" id="url" value="page=0&sort_by=crack_date&is_cracked=true" style="width: 50%;"/>
    <br> <button id="makeRequest" onclick="update_result()">Exécuter</button>
    <div id="result">

    </div>
    <script>

      // donné une URL, retourne une promise qui si résolue, donne en paramètre à la fonction .then() le résultat de la requête de manière traitable
      async function GET_toJsObj(url) {
        return new Promise( (resolve, reject) => {
          var request = new XMLHttpRequest();
          console.log(`Nous faisons notre requête vers : ${url}`)
          request.open('GET', url, true);

          request.onload = function() {
            if (this.status >= 200 && this.status < 400) {
              try {
                const data = JSON.parse(this.response);
                resolve(data);
              } catch(e) {
                console.error(e);
                reject("Data parsing failed. See console for the error.");
              }
            } else {
              reject(`Server returned error code ${this.status}`);
            }
          };
          request.onerror = function(e) {
            console.error(e);
            reject(`Request failed. See console for the error.`);
          };
          request.send();
        });
      }

      function update_result() {
        const input = document.getElementById("url");
        const url = `https://api.crackwatch.com/api/games?${input.value}`;
        GET_toJsObj(url).then(function(result) {
          console.log("résultat obtenu :D : ", result);
        }).catch(function(error) {
          alert(error);
        })
      }


    </script>
  </body>
</html>
